# OAuth 2.0
Modern Guide - What is OAuth 2.0 and How Does It Work?<br>
https://fusionauth.io/articles/oauth/modern-guide-to-oauth<br>
https://oauth.net/

OAuth is industry standard protocol when it comes to Authorization

Here are the OAuth Grant Types:
- Authorization Code
- PKCE
- Client Credentials
- Device Code
- Refresh Token

## What we have seen so far
1. Connection strings: These have the key that is used to access the resource. They are least secure as anyone that has this string can access the resource.<br>
2. Application objects: We registered the app objects and got Tenant ID, Client ID and Client Secret. Using these we accessed the resource.
3. Client credentials: We used the Client ID and Client Secret to get the secure access token. The token is then used to access the resource.

## What is OKTA
Okta is a standards-compliant OAuth 2.0 (opens new window)authorization server and a certified OpenID Connect provider (opens new window).<br>
https://developer.okta.com/docs/reference/api/oidc/

## Client Credentials
We already worked with "Client Credentials" when we requested the token string using Postman in previous section.

```html
POST /token HTTP/1.1
Host: authorization-server.com
 
grant_type=client_credentials
&client_id=xxxxxxxxxx
&client_secret=xxxxxxxxxx
```

## Authorization Code
The Authorization Code Grant Type is probably the most common of the OAuth 2.0 grant types that youâ€™ll encounter. It is used by both web apps and native apps to get an access token after a user authorizes an app.<br>
So when we login into a web app using credentials which could be validated against Entra ID server, the app typically uses Authorization Code grant flow.

Consider the following flow where a user request an image:<br>
User <===> Web App <=====================> Azure Storage Service Web API <====> Azure Storage Account (For Images)

In all this, consider the presence of Authorization Server which is Microsoft Identity Platform in Azure.<br>
It managers end user info, their access and also issues secure access tokens.<br>

Step 1: The app makes a contact with Authorization Server for an authorization code along with a callback (aka Redirect) URL. The Auth code is viewable in browser.

Step 2: The app send back the auth code to the Auth Server to get the access token

Step 3: The application gets the secure access token. The exchange process happens on the backend and you wont see the access token in browser because of security concerns.

Step 4: The app can now use the access token to make a request from Azure Storage Service Web API to get the image


## Login into Azure also use OAuth
When we click on Sign-In for Azure in an incognito browser, the first link used is as below:
https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize?redirect_uri=https%3A%2F%2Fportal.azure.com%2Fsignin%2Findex%2F&response_type=code%20id_token&scope=https%3A%2F%2Fmanagement.core.windows.net%2F%2Fuser_impersonation%20openid%20email%20profile&state=OpenIdConnect.AuthenticationProperties%3DC6_pgAVYRoi4-cBcOjJsrCIoyX7R0nGeZkWJcSlp5O88FKvQMRMoewi9c8bH9b7T6cQ0YDFvzBPTlBfH1g2boRjJk5FWyccVbt2JaHgtJyeHoP1TR5ipbq9IORYEMWdUZ0EPIgcvjNeAAM8KuNzkvANP5PcLaYHQesy74BAzFOoZ76fmYKCZmgkl-KzGEHpXMA0A2EuscTgoB9tmR-rAEqW4nHc3nA3HPUhaFPoxOIOrCfjNidpbudJfqxVd6HByVtvx6ndmau5nA42xsAT-ofhCVHRRFRYnHZbR97VJ1KjaJwtujiBbErSG0oDKSSe9v8ACMzxh4B0O-yc-zMQSKBaLJciKmyp_jAEijR2M81-75wakNhjYUciSakvFl-J8Dres-kG3rdP6GTCWV-E9EZxqwZ5hAmhrCshqL24tAHQQdC_wfkW__xeScy8LbeneMbgWNLfgVH0uqDck3gF1KfTh1W7J5G-b8_fNdFxrNFqBLHXFkY5YmLHrNjbavld8&response_mode=form_post&nonce=638477496109554595.ZGE2ZWY5NGQtNzBlYi00NGRjLWJiMzItOTIxMzQ2ZWU5MGQ3NDk5ODE5YTgtN2E4Yy00ZjNmLTkxZWMtNWE3NWRhMWE4MTRi&client_id=c44b4083-3bb0-49c1-b47d-974e53cbdf3c&site_id=501430&client-request-id=d897fd11-6260-4db4-888b-4c94459fc8b4&x-client-SKU=ID_NET472&x-client-ver=7.2.0.0&sso_reload=true

We then prompted for the username and URL changes to:
https://login.live.com/oauth20_authorize.srf?scope=openid+profile+email+offline_access&response_type=code&client_id=51483342-085c-4d86-bf88-cf50c7252078&response_mode=form_post&redirect_uri=https%3a%2f%2flogin.microsoftonline.com%2fcommon%2ffederation%2foauth2msa&state=rQQIARAAjdPNi-N0GAfwpjPTedF1RhHZ4xwWWdS0SZM06cCAaZsmTfPSpp1mUg81-eU9zUuT9PUvWPCyh4WFvQgiCnNaZA7iaY8yp72I4h8gyyIietmDgt0B73t5nsPz_d4-z9E-Wa6WkTLy0c52nd0DOG7gCIXBmGEgMF4HKGzgpAnXSdwiMGCYNgb4EoGgOIak7x2dvPvv418-N67FB18Ij5gvf7x-Ah1Opt7CKoM4vII-dPM8yc4qlSROc31a1jfz9PZUyTwn8qKKF5nWqvI9BD2HoBcQdFXMahiFkyRer6FInSBwok6UxyxTHasaIbH9XNo0ppqHIBKr-ILKe-Kmk8vDzkrc9LeZC0Jk-5jUCgi5xRDa0MmlKoNrawQZ-1IoDIPVWBVzSWUwSVVcUWVwcah4vxaPZXqeu9XXI069jfVX8dCO03CSxFn-ZOfbXTmxoo7ZjKPIAnn5dcyKcg_ouRdHvTROrDT3rOy8WZskDj3SlNjDYdAAss9nabMTry9JBYlYaxyoPBhME0KmqHZ30RcVMbaWXh1QBlc3yGEN9BGt1V5sGr3htGFzqFM1YsXnA6KtrgEYGXmV1zkn59cWF_fQoUJ4iTGrd2RFY0TVvBgjTK_jgIUvWTQtUt25tAkWtNQjekDQNa5vZWsSb9CbthyPyZodat3mOHSCKdzdsAyXXIo0QleZeQaGTtyo56ECpzQzU_GIA1hEY1zvwtXbvXgld-S0afuSZybG3OTt2Wpk1rjGepQvVrXIDPU5EdF4dZXRQzi23eaIU5S2okXc2FDq5IhHu77OL_O57zUMJh2wSNzqDgZWfUHRTXGzcvEGIsNrAG_E_qDb0AUeeN1wnUx8mvF8pSpSKEwSSz2QXF-7AN5ADxbtKcxTrdTK4IDFUrNXY4dNdQQzdWa8mi3HhEuHbtrM3JlQxXOa6_fN5mRpB-pksrIGYE0JhhVZouGokmA7Iw6Zz1ogwJw22rWHLqqSPMHCBjWxJbO9SqX2rCFwl-1AI7RQ4FLJN_TF1KSudu79Dz7UI92xwi2TLfet-eVWerzMypGVV77buROnjh55m1tA2c2O8Ca1yjyz0okXbrVlcXRbPd3Sizzz1Ap1b3qapLHtTa3nu9DL3Q8O9k-KdwunhfvvI3tnBwdHJ8d3908Lr3ahr_a2b_vT_d_f-uzTYuObF6Prn58VCzd7ld6M9pt9XL4U3ChXAwp0Wr4QCoO-welaJ0QH6GCE62yHRbXz2hn6sAQ9LJVuSoed1kRihjhZ_bMEPdgv_HD4hk__9G3o2Z3Cq3du_v768W__PPqDe3n8CXpp-83U77HJyOmsPu4Tc2Zq5u106wBIznyxMHstTp3jaSU4f3pS-A81&estsfed=1&uaid=d897fd1162604db4888b4c94459fc8b4&cobrandid=ed5d1924-9524-4e70-8f68-5ee5e35afbef&fci=c44b4083-3bb0-49c1-b47d-974e53cbdf3c&***username=vkcode7%40gmail.com&login_hint=vkcode7%40gmail.com***

We are then prompted for password and URL changes to:
https://login.live.com/ppsecure/post.srf?username=vkcode7%40gmail.com&client_id=51483342-085c-4d86-bf88-cf50c7252078&cobrandid=ed5d1924-9524-4e70-8f68-5ee5e35afbef&contextid=5B31434347269670&opid=2CD0A19395976506&bk=1712153032&uaid=d897fd1162604db4888b4c94459fc8b4&pid=15216

Ater we verify with a code it changes to:
https://portal.azure.com/#home
